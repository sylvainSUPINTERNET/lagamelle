---
export const prerender = false
---

<script>

    ( async () => {
        if ( window.location.hash != "" ) {
        try {
          const hash = window.location.hash.substring(1);

          const response = await fetch('/oauth2/google/checkAuth', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            credentials: 'include',
            cache: 'no-cache',
            body: JSON.stringify({"params": new URLSearchParams(hash).toString()})
          });

          if ( response.status !== 200 ) {
            throw new Error("Failed to login");
          }

          window.location.href = "/";
          
        } catch ( e ) {
          alert("Error: Failed to login");
          window.location.href = "/login";
        }
      }
    })()

</script>
